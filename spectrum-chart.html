<!doctype html>
<html>
    <head>
        <title>Spectrum Chart</title>
        <style>
            body {
                margin: 0;
                overflow: hidden;
                touch-action: none;
            }
            #canvas {
                touch-action: none;
            }
            .zoom-controls {
                position: fixed;
                top: 20px;
                right: 20px;
                display: flex;
                flex-direction: column;
                gap: 10px;
                z-index: 1000;
            }
            .button {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                border: none;
                background-color: rgba(255, 255, 255, 0.8);
                cursor: pointer;
                font-size: 24px;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
                transition: background-color 0.2s;
            }
            .button:hover {
                background-color: rgba(255, 255, 255, 0.9);
            }
            .button:active {
                background-color: rgba(255, 255, 255, 1);
                transform: translateY(1px);
                .controls-dropdown {
                    position: fixed;
                    top: 120px;
                    right: 20px;
                    z-index: 1000;
                }
            }

            .dropdown-content {
                display: none;
                position: absolute;
                right: 0;
                background-color: white;
                min-width: 200px;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
                border-radius: 8px;
                padding: 10px;
            }

            .controls-dropdown:hover .dropdown-content {
                display: block;
            }

            .dropdown-content label {
                display: block;
                padding: 5px;
                cursor: pointer;
            }

            .dropdown-content label:hover {
                background-color: #f0f0f0;
            }
        </style>
    </head>
    <body>
        <canvas id="canvas"></canvas>
        <div class="zoom-controls">
            <button class="button" id="zoom-in">+</button>
            <button class="button" id="zoom-minus">−</button>
            <div class="controls-dropdown">
                <button class="button" id="settings">⚙️</button>
                <div class="dropdown-content">
                    <label
                        ><input type="checkbox" id="show-channels" checked />
                        Show Channel Numbers</label
                    >
                    <label
                        ><input type="checkbox" id="show-frequencies" checked />
                        Show Center Frequencies</label
                    >
                    <label
                        ><input type="checkbox" id="show-overlapping" /> Show
                        Show overlapping channels</label
                    >
                    <label>
                        Height:
                        <input
                            type="range"
                            id="height-slider"
                            min="20"
                            max="200"
                            value="80"
                        />
                    </label>
                </div>
            </div>
        </div>
        <script>
            const canvas = document.getElementById("canvas");
            const ctx = canvas.getContext("2d");
            const heightSlider = document.getElementById("height-slider");

            // State variables
            let showChannels = true;
            let showFrequencies = true;
            let showOverlapping = false;
            let offset = { x: 0, y: 0 };
            let scale = 1;
            let isDragging = false;
            let lastPosition = { x: 0, y: 0 };
            let lastPinchDistance = null;
            let isSpacebarDown = false;
            let lockX, lockY;

            // Visual settings
            const chartSettings = {
                channelWidth: 100,
                channelHeight: 80, // Default height
                baselineOffset: 20,
                channelGap: 20, // I don't like that this is static
                textSize: 12,
            };

            const wifiChannels = {
                "2.4 GHz": [
                    { channel: 1, frequency: 2412, width: 20 },
                    {
                        channel: 2,
                        frequency: 2417,
                        width: 20,
                        overlapping: true,
                    },
                    {
                        channel: 3,
                        frequency: 2422,
                        width: 20,
                        overlapping: true,
                    },
                    {
                        channel: 4,
                        frequency: 2427,
                        width: 20,
                        overlapping: true,
                    },
                    {
                        channel: 5,
                        frequency: 2432,
                        width: 20,
                        overlapping: true,
                    },
                    { channel: 6, frequency: 2437, width: 20 },
                    {
                        channel: 7,
                        frequency: 2442,
                        width: 20,
                        overlapping: true,
                    },
                    {
                        channel: 8,
                        frequency: 2447,
                        width: 20,
                        overlapping: true,
                    },
                    {
                        channel: 9,
                        frequency: 2452,
                        width: 20,
                        overlapping: true,
                    },
                    {
                        channel: 10,
                        frequency: 2457,
                        width: 20,
                        overlapping: true,
                    },
                    { channel: 11, frequency: 2462, width: 20 },
                ],
                "5 GHz": [
                    { channel: 36, frequency: 5180, width: 20 },
                    { channel: 40, frequency: 5200, width: 20 },
                    { channel: 44, frequency: 5220, width: 20 },
                    { channel: 48, frequency: 5240, width: 20 },
                    { channel: 52, frequency: 5260, width: 20 },
                    { channel: 56, frequency: 5280, width: 20 },
                    { channel: 60, frequency: 5300, width: 20 },
                    { channel: 64, frequency: 5320, width: 20 },
                    { channel: 100, frequency: 5500, width: 20 },
                    { channel: 104, frequency: 5520, width: 20 },
                    { channel: 108, frequency: 5540, width: 20 },
                    { channel: 112, frequency: 5560, width: 20 },
                    { channel: 116, frequency: 5580, width: 20 },
                    { channel: 120, frequency: 5600, width: 20 },
                    { channel: 124, frequency: 5620, width: 20 },
                    { channel: 128, frequency: 5640, width: 20 },
                    { channel: 132, frequency: 5660, width: 20 },
                    { channel: 136, frequency: 5680, width: 20 },
                    { channel: 140, frequency: 5700, width: 20 },
                    { channel: 144, frequency: 5720, width: 20 },
                    { channel: 149, frequency: 5745, width: 20 },
                    { channel: 153, frequency: 5765, width: 20 },
                    { channel: 157, frequency: 5785, width: 20 },
                    { channel: 161, frequency: 5805, width: 20 },
                    { channel: 165, frequency: 5825, width: 20 },
                ],
                "6 GHz": [
                    { channel: "1E", frequency: 5955, width: 20 },
                    { channel: "5E", frequency: 5975, width: 20 },
                    { channel: "9E", frequency: 5995, width: 20 },
                    { channel: "13E", frequency: 6015, width: 20 },
                    { channel: "17E", frequency: 6035, width: 20 },
                    { channel: "21E", frequency: 6055, width: 20 },
                    { channel: "25E", frequency: 6075, width: 20 },
                    { channel: "29E", frequency: 6095, width: 20 },
                    { channel: "33E", frequency: 6115, width: 20 },
                    { channel: "37E", frequency: 6135, width: 20 },
                    { channel: "41E", frequency: 6155, width: 20 },
                    { channel: "45E", frequency: 6175, width: 20 },
                    { channel: "49E", frequency: 6195, width: 20 },
                    { channel: "53E", frequency: 6215, width: 20 },
                    { channel: "57E", frequency: 6235, width: 20 },
                    { channel: "61E", frequency: 6255, width: 20 },
                    { channel: "65E", frequency: 6275, width: 20 },
                    { channel: "69E", frequency: 6295, width: 20 },
                    { channel: "73E", frequency: 6315, width: 20 },
                    { channel: "77E", frequency: 6335, width: 20 },
                    { channel: "81E", frequency: 6355, width: 20 },
                    { channel: "85E", frequency: 6375, width: 20 },
                    { channel: "89E", frequency: 6395, width: 20 },
                    { channel: "93E", frequency: 6415, width: 20 },
                    { channel: "97E", frequency: 6435, width: 20 },
                    { channel: "101E", frequency: 6455, width: 20 },
                    { channel: "105E", frequency: 6475, width: 20 },
                    { channel: "109E", frequency: 6495, width: 20 },
                    { channel: "113E", frequency: 6515, width: 20 },
                    { channel: "117E", frequency: 6535, width: 20 },
                    { channel: "121E", frequency: 6555, width: 20 },
                    { channel: "125E", frequency: 6575, width: 20 },
                    { channel: "129E", frequency: 6595, width: 20 },
                    { channel: "133E", frequency: 6615, width: 20 },
                    { channel: "137E", frequency: 6635, width: 20 },
                    { channel: "141E", frequency: 6655, width: 20 },
                    { channel: "145E", frequency: 6675, width: 20 },
                    { channel: "149E", frequency: 6695, width: 20 },
                    { channel: "153E", frequency: 6715, width: 20 },
                    { channel: "157E", frequency: 6735, width: 20 },
                    { channel: "161E", frequency: 6755, width: 20 },
                    { channel: "165E", frequency: 6775, width: 20 },
                    { channel: "169E", frequency: 6795, width: 20 },
                    { channel: "173E", frequency: 6815, width: 20 },
                    { channel: "177E", frequency: 6835, width: 20 },
                    { channel: "181E", frequency: 6855, width: 20 },
                    { channel: "185E", frequency: 6875, width: 20 },
                    { channel: "189E", frequency: 6895, width: 20 },
                    { channel: "193E", frequency: 6915, width: 20 },
                    { channel: "197E", frequency: 6935, width: 20 },
                    { channel: "201E", frequency: 6955, width: 20 },
                    { channel: "205E", frequency: 6975, width: 20 },
                    { channel: "209E", frequency: 6995, width: 20 },
                    { channel: "213E", frequency: 7015, width: 20 },
                    { channel: "217E", frequency: 7035, width: 20 },
                    { channel: "221E", frequency: 7055, width: 20 },
                    { channel: "225E", frequency: 7075, width: 20 },
                    { channel: "229E", frequency: 7095, width: 20 },
                    { channel: "233E", frequency: 7115, width: 20 },
                ],
            };

            // Set canvas size to window size
            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            resizeCanvas();
            window.addEventListener("resize", resizeCanvas);

            // Drawing function
            function draw() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                // Convert MHz to screen pixels, taking zoom into account
                function mhzToScreenX(mhz) {
                    const pixelsPerMhz = 2 * scale;
                    return (
                        (mhz - 2400) * pixelsPerMhz +
                        canvas.width / 2 +
                        offset.x
                    );
                }

                // Draw baseline
                ctx.beginPath();
                ctx.moveTo(mhzToScreenX(2400), canvas.height / 2);
                ctx.lineTo(mhzToScreenX(7125), canvas.height / 2);
                ctx.strokeStyle = "black";
                ctx.lineWidth = 2;
                ctx.stroke();

                // Draw all bands
                ["2.4 GHz", "5 GHz", "6 GHz"].forEach((band) => {
                    const channels = wifiChannels[band];

                    channels.forEach((channel) => {
                        // Skip overlapping 2.4 GHz channels if not enabled
                        if (
                            band === "2.4 GHz" &&
                            channel.overlapping &&
                            !showOverlapping
                        ) {
                            // Changed the condition to check the overlapping property
                            return;
                        }

                        const centerX = mhzToScreenX(channel.frequency);
                        const channelWidthScreen = channel.width * 2 * scale;
                        const topWidth = channelWidthScreen * 0.8;
                        const centerY = canvas.height / 2;

                        // Use chartSettings.channelHeight for the height
                        const channelHeight = chartSettings.channelHeight; // Get current height setting

                        // Draw ziggurat with dynamic height
                        ctx.beginPath();
                        ctx.moveTo(
                            centerX - topWidth / 2,
                            centerY - channelHeight,
                        );
                        ctx.lineTo(centerX - channelWidthScreen / 2, centerY);
                        ctx.moveTo(
                            centerX + topWidth / 2,
                            centerY - channelHeight,
                        );
                        ctx.lineTo(centerX + channelWidthScreen / 2, centerY);
                        ctx.moveTo(
                            centerX - topWidth / 2,
                            centerY - channelHeight,
                        );
                        ctx.lineTo(
                            centerX + topWidth / 2,
                            centerY - channelHeight,
                        );
                        ctx.strokeStyle = "#0066cc";
                        ctx.lineWidth = 2;
                        ctx.lineCap = "round";
                        ctx.stroke();

                        const labelSpacing = 15;
                        let currentY = centerY + chartSettings.baselineOffset;

                        // Draw channel number
                        if (showChannels) {
                            ctx.font = `${chartSettings.textSize}px Arial`;
                            ctx.fillStyle = "black";
                            ctx.textAlign = "center";
                            ctx.fillText(
                                `${channel.channel}`,
                                centerX,
                                currentY,
                            );
                            currentY += labelSpacing;
                        }

                        // Draw frequency
                        if (showFrequencies) {
                            ctx.font = `${chartSettings.textSize}px Arial`;
                            ctx.fillStyle = "black";
                            ctx.textAlign = "center";
                            ctx.fillText(
                                `${channel.frequency}`,
                                centerX,
                                currentY,
                            );
                        }
                    });
                });

                requestAnimationFrame(draw);
            }

            // Mouse events for panning
            canvas.addEventListener("mousedown", (e) => {
                isDragging = true;
                lastPosition = { x: e.clientX, y: e.clientY };
            });

            canvas.addEventListener("mousemove", (e) => {
                if (isDragging) {
                    offset.x += e.clientX - lastPosition.x;
                    lastPosition.x = e.clientX;
                }
            });

            canvas.addEventListener("mouseup", () => {
                isDragging = false;
            });

            canvas.addEventListener("mouseleave", () => {
                isDragging = false;
            });

            // Touch events for panning and pinch zooming
            canvas.addEventListener("touchstart", (e) => {
                if (e.touches.length === 1) {
                    isDragging = true;
                    lastPosition = {
                        x: e.touches[0].clientX,
                        y: e.touches[0].clientY,
                    };
                }
            });

            canvas.addEventListener("touchmove", (e) => {
                if (e.touches.length === 2) {
                    // Handle pinch zooming
                    const touch1 = e.touches[0];
                    const touch2 = e.touches[1];

                    // Calculate center of pinch
                    const pinchCenterX = (touch1.clientX + touch2.clientX) / 2;
                    const rect = canvas.getBoundingClientRect();
                    const centerX = pinchCenterX - rect.left - canvas.width / 2;

                    // Calculate new scale based on pinch distance
                    const currentDistance = Math.abs(
                        touch1.clientX - touch2.clientX,
                    );

                    if (lastPinchDistance) {
                        const scaleChange = currentDistance / lastPinchDistance;
                        const oldScale = scale;
                        scale *= scaleChange;
                        scale = Math.min(Math.max(0.1, scale), 5);

                        // Adjust offset to zoom towards pinch center
                        const centerFreq = screenXToMhz(pinchCenterX);
                        offset.x = pinchCenterX - mhzToScreenX(centerFreq);
                    }

                    lastPinchDistance = currentDistance;
                } else if (e.touches.length === 1 && isDragging) {
                    offset.x += e.touches[0].clientX - lastPosition.x;
                    lastPosition.x = e.touches[0].clientX;
                }
            });

            canvas.addEventListener("touchend", () => {
                isDragging = false;
                lastPinchDistance = null;
            });

            // Mouse wheel zooming
            canvas.addEventListener("wheel", (e) => {
                e.preventDefault();

                if (e.deltaY !== 0) {
                    // Get mouse position and convert to frequency
                    const rect = canvas.getBoundingClientRect();
                    const mouseX = e.clientX - rect.left;
                    const centerFreq = screenXToMhz(mouseX);

                    // Calculate new scale
                    const oldScale = scale;
                    const zoomFactor = e.deltaY > 0 ? 0.9 : 1.1;
                    scale = Math.min(Math.max(0.1, scale * zoomFactor), 5);

                    // Adjust offset to zoom towards mouse position
                    const newMouseX = mhzToScreenX(centerFreq);
                    offset.x += mouseX - newMouseX;
                }

                if (e.deltaX !== 0) {
                    offset.x -= e.deltaX;
                }
            });

            // Zoom buttons
            document.getElementById("zoom-in").addEventListener("click", () => {
                const centerFreq = screenXToMhz(canvas.width / 2);
                const oldScale = scale;
                scale *= 1.2;
                scale = Math.min(Math.max(0.1, scale), 5);
                const newCenterX = mhzToScreenX(centerFreq);
                offset.x += canvas.width / 2 - newCenterX;
            });

            document
                .getElementById("zoom-minus")
                .addEventListener("click", () => {
                    const centerFreq = screenXToMhz(canvas.width / 2);
                    const oldScale = scale;
                    scale *= 0.8;
                    scale = Math.min(Math.max(0.1, scale), 5);
                    const newCenterX = mhzToScreenX(centerFreq);
                    offset.x += canvas.width / 2 - newCenterX;
                });

            // Event listeners for checkboxes
            document
                .getElementById("show-channels")
                .addEventListener("change", (e) => {
                    showChannels = e.target.checked;
                });

            document
                .getElementById("show-frequencies")
                .addEventListener("change", (e) => {
                    showFrequencies = e.target.checked;
                });

            document
                .getElementById("show-overlapping")
                .addEventListener("change", (e) => {
                    showOverlapping = e.target.checked;
                });

            heightSlider.addEventListener("input", (e) => {
                chartSettings.channelHeight = parseInt(e.target.value);
            });

            // Helper functions for coordinate conversion
            function mhzToScreenX(mhz) {
                const pixelsPerMhz = 2 * scale;
                return (
                    (mhz - 2400) * pixelsPerMhz + canvas.width / 2 + offset.x
                );
            }

            function screenXToMhz(screenX) {
                const pixelsPerMhz = 2 * scale;
                return (
                    (screenX - canvas.width / 2 - offset.x) / pixelsPerMhz +
                    2400
                );
            }

            // Start the animation
            draw();
        </script>
    </body>
</html>
